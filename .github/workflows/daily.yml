name: Daily Job Search

on:
  schedule:
    - cron: "0 4 * * *"
  workflow_dispatch:

jobs:
  run-job-search:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0   # 必须

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: pip install -r requirements.txt

      - name: Run search
        run: python run.py

      # 把生成文件放入 results/
      - name: Move files
        run: |
          mkdir -p results
          mv job_results_*.json results/

      - name: Push to data-history branch
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Daily job results"
          branch: data-history
          file_pattern: results/*.json
